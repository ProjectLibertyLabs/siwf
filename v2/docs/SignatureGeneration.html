<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Signature Generation - Sign In With Frequency</title>


        <!-- Custom HTML head -->

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" type="image/svg+xml" href="favicon.svg">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="css/highlight.css">
        <link rel="stylesheet" href="css/highlight-dark.css">
        <link rel="stylesheet" href="css/tailwind-short.css">
        <link rel="stylesheet" href="css/button-links.css">
        <link rel="stylesheet" href="css/generator.css">
        <link rel="stylesheet" href="css/overrides.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "coal" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Dark</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/ProjectLibertyLabs/siwf" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/ProjectLibertyLabs/siwf/blob/main/docs/src/SignatureGeneration.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Type to search..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="authentication-url-signature"><a class="header" href="#authentication-url-signature">Authentication URL Signature</a></h1>
<p>Most applications skip all of this and just <a href="./Generate.html">generate the login request payload and signature</a>.</p>
<h2 id="step-1-create-the-payload-for-signing"><a class="header" href="#step-1-create-the-payload-for-signing">Step 1: Create the Payload for Signing</a></h2>
<h3 id="parameter-callback"><a class="header" href="#parameter-callback">Parameter: <code>callback</code></a></h3>
<p>When the user has completed the authentication, this is the return URI that will be used.</p>
<p>Appended to the URL will be this parameter:</p>
<ul>
<li><code>authorizationCode</code> Used to retrieve the full response payload</li>
</ul>
<p>The callback url <em>will maintain</em> any other URL parameters included.
For example, if you wish to correlate the original unauthorized session with the authorized session, you can generate a dynamic callback url with a parameter with a random UUIDv4 identifier on each request.</p>
<h3 id="parameter-permissions"><a class="header" href="#parameter-permissions">Parameter: <code>permissions</code></a></h3>
<p>The list of Frequency Schema Ids permissions your application is requesting from the user.</p>
<ul>
<li>See a full list of <a href="./Delegations.html">Available Delegations</a></li>
</ul>
<h3 id="parameter-useridentifieradminurl"><a class="header" href="#parameter-useridentifieradminurl">Parameter: <code>userIdentifierAdminUrl</code></a></h3>
<p>Only used for custom integration situations.</p>
<h2 id="step-2-signing-the-request"><a class="header" href="#step-2-signing-the-request">Step 2: Signing the Request</a></h2>
<p>To ensure that the correct application is requesting the authentication and that the response is only sent to the authorized party, the request is signed.
The signature MUST be from one of the <a href="https://docs.frequency.xyz/Identity/ControlKeys.html">Control Keys</a> of the Frequency Provider.</p>
<h3 id="2a-serialize-the-payload-using-the-scale-codec"><a class="header" href="#2a-serialize-the-payload-using-the-scale-codec">2a: Serialize the payload using the <a href="https://docs.substrate.io/reference/scale-codec/">SCALE Codec</a></a></h3>
<p>SCALE Type (Note: Order matters!)</p>
<pre><code class="language-json">{
  "callback": "String",
  "permissions": "Vec&lt;U16&gt;",
  "userIdentifierAdminUrl": "Option&lt;String&gt;",
}
</code></pre>
<h3 id="2b-wrap-the-payload"><a class="header" href="#2b-wrap-the-payload">2b: Wrap the Payload</a></h3>
<p>So that no payloads can be accidentally used on a chain, the payload is wrapped with a <code>&lt;Bytes&gt;</code> tag.</p>
<p>Byte Arrays Concatenated: <code>[ 60, 66, 121, 116, 101, 115, 62 ] + scale_encoded_payload_bytes + [ 60, 47, 66, 121, 116, 101, 115, 62 ]</code></p>
<h3 id="2c-sign-the-wrapped-payload-bytes"><a class="header" href="#2c-sign-the-wrapped-payload-bytes">2c: Sign the Wrapped Payload Bytes</a></h3>
<p>Sign the serialized payload using Schnorr signatures over ECDSA.</p>
<h3 id="2d-example"><a class="header" href="#2d-example">2d: Example</a></h3>
<p>Remember that SR25519 signatures are non-deterministic, so the payload and encoding will match, but the signature will be different.
This example uses the <code>//Alice</code> seed phrase to generate the signature.</p>
<ul>
<li>Payload: <code>{ "callback": "https://localhost:44181", "permissions": [5, 7, 8, 9, 10] }</code></li>
<li>SCALE Payload (Hex): <code>0x5c68747470733a2f2f6c6f63616c686f73743a34343138311405000700080009000a0000</code></li>
<li>Wrapped Payload (Hex): <code>0x3c42797465733e5c68747470733a2f2f6c6f63616c686f73743a34343138311405000700080009000a00003c2f42797465733e</code></li>
<li>Signing Public Key (SS58 Prefix 90): <code>f6cL4wq1HUNx11TcvdABNf9UNXXoyH47mVUwT59tzSFRW8yDH</code></li>
<li>Signature (Hex): <code>0x9abd3c54e7164e8385627dc692724b9467386acd7b02a13d6187e2c58fd91440d9134781c0410a45812f5532b71f4a34b4a5443ef8d68b5a1956f7f0f81d4286</code></li>
</ul>
<h2 id="step-3-optional-request-credentials-graph-key-email-phone"><a class="header" href="#step-3-optional-request-credentials-graph-key-email-phone">Step 3 (Optional): Request Credentials (Graph Key, Email, Phone)</a></h2>
<p>Frequency Access users can provide verified email or phone/SMS to your application when requested and approved by the user.
This is <em>not</em> required, and best practice is to only make such a request if it is required for the functioning of the application.</p>
<p>The request MUST be wrapped in <code>requestedCredentials</code> which is an array that requires ALL listed credential objects.
Supported Options:</p>
<ul>
<li><code>anyOf</code>: Request for one or more credentials from the list (0+ may return)</li>
</ul>
<pre><code class="language-json">{
  // ...
  "requestedCredentials": [
    {
      "type": "VerifiedGraphKeyCredential",
      "hash": ["bciqmdvmxd54zve5kifycgsdtoahs5ecf4hal2ts3eexkgocyc5oca2y"]
    }
    {
      "anyOf": [
        // List of contact credential requests here
        {
          "type": "VerifiedEmailAddressCredential",
          "hash": ["bciqe4qoczhftici4dzfvfbel7fo4h4sr5grco3oovwyk6y4ynf44tsi"]
        },
        {
          "type": "VerifiedPhoneNumberCredential",
          "hash": ["bciqjspnbwpc3wjx4fewcek5daysdjpbf5xjimz5wnu5uj7e3vu2uwnq"]
        }
      ]
    }
  ]
}
</code></pre>
<ul>
<li>See a full list of <a href="./Credentials.html">Available Credentials</a></li>
</ul>
<h2 id="step-4-recommended-provide-application-context"><a class="header" href="#step-4-recommended-provide-application-context">Step 4 (Recommended): Provide Application Context</a></h2>
<p>To help users understand which application is asking them to sign in, you can provide an <code>applicationContext</code> object that contains the URL of an application context credential.
This is especially important if you want to manage multiple applications under a single provider identity.
Note that any delegations that are granted by the user will apply to all applications for that provider.</p>
<pre><code class="language-json">{
  // ...
  "applicationContext": {
    "url": "https://example.org/myapp/siwf-manifest.json"
  }
}
</code></pre>
<p>The application context credential is a JSON-formatted verifiable credential that MAY be signed by a credential issuer.
If you are integrating with Frequency Access, your application context details will be created as part of the provisioning process.</p>
<p>For detailed information on the credential schema and properties, see the <a href="./DataStructures/All.html#application-context">full specification and example</a>.</p>
<h3 id="example-using-typescriptjavascript"><a class="header" href="#example-using-typescriptjavascript">Example Using TypeScript/JavaScript</a></h3>
<pre><code class="language-typescript">// This is the URI of a key. Usually just a seed phrase, but also supports test accounts such as `//Alice` or `//Bob`
const providerKeyUri: string = getProviderKeyUriSecret();

// The list of Frequency Schemas Ids that you are requesting the user delegate
// See a full reference: https://projectlibertylabs.github.io/siwf/v2/docs/Delegations.html
// This example is for Graph Only
const permissions: number[] = [7, 8, 9, 10];

// List of Credentials
// See a full reference and examples: https://projectlibertylabs.github.io/siwf/v2/docs/Credentials.html
const credentials = [
  {
    anyOf: [siwf.VerifiedEmailAddressCredential, siwf.VerifiedPhoneNumberCredential],
  },
  siwf.VerifiedGraphKeyCredential,
];

// This is a reference to an application context credential
const applicationContext = {
  url: "https://example.org/myapp/context.json",
};

// This is the URI that the user should return to after authenticating
const callbackUri: string = getWebOrApplicationCallbackUri();

// The Encoded Signed Request can remain static if
// It is the same as is generated with the Signed Payload Generation Tool
const encodedSignedRequest = await siwf.generateEncodedSignedRequest(
  providerKeyUri,
  callbackUri,
  permissions,
  credentials,
  applicationContext,
);

// Options with endpoint selection
// Endpoint may be tagged or specified in full
const options = { endpoint: "production" };
// Staging-Testnet Options
// const options = { endpoint: 'staging' };

const authenticationUrl: string = generateAuthenticationUrl(signedRequest, new URLSearchParams({ id: getSessionId() }));
</code></pre>
<h3 id="full-example-request"><a class="header" href="#full-example-request">Full Example Request</a></h3>
<pre><code class="language-json">{
  "requestedSignatures": {
    "publicKey": {
      "encodedValue": "f6cL4wq1HUNx11TcvdABNf9UNXXoyH47mVUwT59tzSFRW8yDH",
      "encoding": "base58",
      "format": "ss58",
      "type": "Sr25519"
    },
    "signature": {
      "algo": "SR25519",
      "encoding": "base16",
      "encodedValue": "0x0407ce814b77861df94d16b3fcb317d37a07abc2a7f9cd7c02cc22529ee7b32d56795f88bd6b4ad106b72b91b6246a783671bcd24cb01aaf0e9316db5e0cd085"
    },
    "payload": {
      "callback": "http://localhost:3000",
      "permissions": [
        5,
        7,
        8,
        9,
        10
      ]
    }
  },
  "requestedCredentials": [
    {
      "type": "VerifiedGraphKeyCredential",
      "hash": [
        "bciqmdvmxd54zve5kifycgsdtoahs5ecf4hal2ts3eexkgocyc5oca2y"
      ]
    },
    {
      "anyOf": [
        {
          "type": "VerifiedEmailAddressCredential",
          "hash": [
            "bciqe4qoczhftici4dzfvfbel7fo4h4sr5grco3oovwyk6y4ynf44tsi"
          ]
        },
        {
          "type": "VerifiedPhoneNumberCredential",
          "hash": [
            "bciqjspnbwpc3wjx4fewcek5daysdjpbf5xjimz5wnu5uj7e3vu2uwnq"
          ]
        }
      ]
    }
  ],
  "applicationContext": {
    "url": "https://example.org/myapp/siwf-manifest.json",
    "hash": [
      "bciqmdvmxd54zve5kifycgsdtoahs5ecf4hal2ts3eexkgocyc5oca2y"
    ]
  }
}
</code></pre>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>See <a href="./Actions/Start.html">Start</a> for details on how to use the generated signature.</p>
<h3 id="serialization"><a class="header" href="#serialization">Serialization</a></h3>
<ol>
<li>JSON Stringify the <code>SignedRequest</code> object</li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc4648#section-5"><code>base64url</code></a> encode the stringified result</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="Reference.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="Generate.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                <!-- Mobile navigation buttons -->
                <!-- MOD: Show names and Chevrons -->
                  <a rel="prev" href="Reference.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter: Reference" aria-keyshortcuts="Left">
                      <svg height="1.75em" style="display: inline" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3" class="chevron" style="display:inline" viewBox="0 0 24 26"><path d="m15 6-6 6 6 6"/></svg>Reference
                  </a>

                  <a rel="next" href="Generate.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter: Generator" aria-keyshortcuts="Right">
                      Generator<svg height="1.75em" style="display: inline" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3" class="chevron" style="display:inline" viewBox="0 0 24 26"><path d="m9 18 6-6-6-6"/></svg>
                  </a>
              <div style="clear: both"></div>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
