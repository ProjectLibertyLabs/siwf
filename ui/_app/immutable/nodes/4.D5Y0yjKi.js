import{S as ve,i as be,s as Me,d as p,x as we,o as R,p as T,Z as Ee,_ as We,b,v as S,e as w,f as q,j as E,V as J,W as K,a6 as ke,m as Q,U as ie,a as G,X as $,c as I,q as x,O as je,h as H,g as O,r as ee,w as te,k as P,t as V,u as se,l as F,z as Ce,Y as re}from"../chunks/DDfy8cKU.js";import"../chunks/IHki7fMi.js";import{a as Le}from"../chunks/D9Y3WYr6.js";import{b as ae,g as ue}from"../chunks/C3LnTUjX.js";import{C as de}from"../chunks/CNtjwfdd.js";import{e as fe}from"../chunks/D6YF6ztN.js";import{v as _e,V as me,f as De,x as Oe}from"../chunks/Co0xxR5R.js";import{W as Ve}from"../chunks/wepwe_yX.js";import{F as qe}from"../chunks/BhBRXKnp.js";import{R as he}from"../chunks/BWmspDa1.js";function pe(a,c,e){const r=a.slice();return r[11]=c[e],r}function ge(a){var ce;let c,e,r,n=!1,u,l,o=_e(a[11].handle)+"",t,h,A,M=me(a[11].handle)+"",f,g,_,s=a[11].msaId+"",d,v,k,D,W,y,z,U,C,ne='<hr class="flex-grow"/> ',L,X,Y,le;function Se(i){a[8](i)}function Ie(i){a[9](i)}let Z={active:a[11].msaId===a[2],accounts:Object.values(a[11].accounts),initialSelectedAddress:((ce=a[1])==null?void 0:ce.address)||Object.keys(a[11].accounts)[0]};return a[4]!==void 0&&(Z.selectedAddress=a[4]),a[3]!==void 0&&(Z.selectedAccount=a[3]),W=new Ve({props:Z}),J.push(()=>K(W,"selectedAddress",Se)),J.push(()=>K(W,"selectedAccount",Ie)),X=ke(a[7][0]),{c(){c=E("label"),e=E("input"),u=P(),l=E("span"),t=V(o),h=E("span"),A=V("."),f=V(M),g=E("span"),_=V("(MSA "),d=V(s),v=V(")"),k=P(),D=E("div"),se(W.$$.fragment),U=P(),C=E("div"),C.innerHTML=ne,this.h()},l(i){c=w(i,"LABEL",{class:!0});var m=q(c);e=w(m,"INPUT",{type:!0,name:!0}),u=H(m),l=w(m,"SPAN",{class:!0});var j=q(l);t=O(j,o),j.forEach(p),h=w(m,"SPAN",{class:!0});var N=q(h);A=O(N,"."),f=O(N,M),N.forEach(p),g=w(m,"SPAN",{class:!0});var B=q(g);_=O(B,"(MSA "),d=O(B,s),v=O(B,")"),B.forEach(p),m.forEach(p),k=H(i),D=w(i,"DIV",{class:!0});var oe=q(D);ee(W.$$.fragment,oe),oe.forEach(p),U=H(i),C=w(i,"DIV",{class:!0,"data-svelte-h":!0}),te(C)!=="svelte-hkjkqh"&&(C.innerHTML=ne),this.h()},h(){S(e,"type","radio"),S(e,"name","msa"),e.__value=r=a[11].msaId,ie(e,e.__value),S(l,"class","text-white"),S(h,"class","text-neutral-400"),S(g,"class","pl-5 text-white"),S(c,"class","text-base font-semibold"),S(D,"class","pl-5"),S(C,"class","flex items-center pb-5 pt-3"),X.p(e)},m(i,m){b(i,c,m),I(c,e),e.checked=e.__value===a[2],I(c,u),I(c,l),I(l,t),I(c,h),I(h,A),I(h,f),I(c,g),I(g,_),I(g,d),I(g,v),b(i,k,m),b(i,D,m),x(W,D,null),b(i,U,m),b(i,C,m),L=!0,Y||(le=je(e,"change",a[6]),Y=!0)},p(i,m){var N;(!L||m&1&&r!==(r=i[11].msaId))&&(e.__value=r,ie(e,e.__value),n=!0),(n||m&5)&&(e.checked=e.__value===i[2]),(!L||m&1)&&o!==(o=_e(i[11].handle)+"")&&G(t,o),(!L||m&1)&&M!==(M=me(i[11].handle)+"")&&G(f,M),(!L||m&1)&&s!==(s=i[11].msaId+"")&&G(d,s);const j={};m&5&&(j.active=i[11].msaId===i[2]),m&1&&(j.accounts=Object.values(i[11].accounts)),m&3&&(j.initialSelectedAddress=((N=i[1])==null?void 0:N.address)||Object.keys(i[11].accounts)[0]),!y&&m&16&&(y=!0,j.selectedAddress=i[4],$(()=>y=!1)),!z&&m&8&&(z=!0,j.selectedAccount=i[3],$(()=>z=!1)),W.$set(j)},i(i){L||(T(W.$$.fragment,i),L=!0)},o(i){R(W.$$.fragment,i),L=!1},d(i){i&&(p(c),p(k),p(D),p(U),p(C)),Q(W),X.r(),Y=!1,le()}}}function Ne(a){let c,e,r=fe(a[0]),n=[];for(let l=0;l<r.length;l+=1)n[l]=ge(pe(a,r,l));const u=l=>R(n[l],1,1,()=>{n[l]=null});return{c(){c=E("div");for(let l=0;l<n.length;l+=1)n[l].c();this.h()},l(l){c=w(l,"DIV",{class:!0});var o=q(c);for(let t=0;t<n.length;t+=1)n[t].l(o);o.forEach(p),this.h()},h(){S(c,"class","flex h-[380px] w-full flex-col overflow-auto bg-transparent")},m(l,o){b(l,c,o);for(let t=0;t<n.length;t+=1)n[t]&&n[t].m(c,null);e=!0},p(l,[o]){if(o&31){r=fe(l[0]);let t;for(t=0;t<r.length;t+=1){const h=pe(l,r,t);n[t]?(n[t].p(h,o),T(n[t],1)):(n[t]=ge(h),n[t].c(),T(n[t],1),n[t].m(c,null))}for(Ee(),t=r.length;t<n.length;t+=1)u(t);We()}},i(l){if(!e){for(let o=0;o<r.length;o+=1)T(n[o]);e=!0}},o(l){n=n.filter(Boolean);for(let o=0;o<n.length;o+=1)R(n[o]);e=!1},d(l){l&&p(c),we(n,l)}}}function Te(a,c,e){let{msaEntries:r=[]}=c,{selectedMsaWithAccount:n}=c,{initialSelection:u}=c,l,o,t;function h(_,s){const d=r.find(v=>v.msaId===_);if(d){const{accounts:v,...k}=d;e(5,n={...k,account:s})}}const A=[[]];function M(){l=this.__value,e(2,l),e(5,n),e(0,r),e(1,u)}function f(_){t=_,e(4,t)}function g(_){o=_,e(3,o)}return a.$$set=_=>{"msaEntries"in _&&e(0,r=_.msaEntries),"selectedMsaWithAccount"in _&&e(5,n=_.selectedMsaWithAccount),"initialSelection"in _&&e(1,u=_.initialSelection)},a.$$.update=()=>{var _;if(a.$$.dirty&39&&!n&&r.length>0){let s=r[0],d=Object.values(s.accounts)[0];u&&(s=r.find(v=>v.msaId===(u==null?void 0:u.msaId))||s,d=((_=s.accounts)==null?void 0:_[u.address])||Object.values(s.accounts)[0]),e(2,l=s.msaId),h(l,d)}a.$$.dirty&12&&l&&o&&h(l,o)},[r,u,l,o,t,n,M,A,f,g]}class He extends ve{constructor(c){super(),be(this,c,Te,Ne,Me,{msaEntries:0,selectedMsaWithAccount:5,initialSelection:1})}}const Ae=De("LastUsedMsaAndAddress");function Pe(a){let c;return{c(){c=V("Next > Sign In")},l(e){c=O(e,"Next > Sign In")},m(e,r){b(e,c,r)},d(e){e&&p(c)}}}function Re(a){let c,e='<span class="text-[16px] font-bold">Choose a handle to sign in with</span>',r,n,u,l,o,t,h,A,M=`<a href="${`${ae}/signup/handle`}" class="text-center text-sm font-semibold">Create an account</a>`,f;function g(s){a[4](s)}let _={msaEntries:Object.values(a[2]),initialSelection:a[1]};return a[0]!==void 0&&(_.selectedMsaWithAccount=a[0]),u=new He({props:_}),J.push(()=>K(u,"selectedMsaWithAccount",g)),t=new qe({props:{$$slots:{default:[Pe]},$$scope:{ctx:a}}}),t.$on("click",a[3]),{c(){c=E("div"),c.innerHTML=e,r=P(),n=E("div"),se(u.$$.fragment),o=P(),se(t.$$.fragment),h=P(),A=E("div"),A.innerHTML=M,this.h()},l(s){c=w(s,"DIV",{class:!0,"data-svelte-h":!0}),te(c)!=="svelte-6zb4of"&&(c.innerHTML=e),r=H(s),n=w(s,"DIV",{class:!0});var d=q(n);ee(u.$$.fragment,d),d.forEach(p),o=H(s),ee(t.$$.fragment,s),h=H(s),A=w(s,"DIV",{class:!0,"data-svelte-h":!0}),te(A)!=="svelte-1560jx3"&&(A.innerHTML=M),this.h()},h(){S(c,"class","flex h-full items-center justify-center pb-9"),S(n,"class","pb-[64px]"),S(A,"class","flex items-center justify-center pb-4 pt-8")},m(s,d){b(s,c,d),b(s,r,d),b(s,n,d),x(u,n,null),b(s,o,d),x(t,s,d),b(s,h,d),b(s,A,d),f=!0},p(s,[d]){const v={};d&4&&(v.msaEntries=Object.values(s[2])),d&2&&(v.initialSelection=s[1]),!l&&d&1&&(l=!0,v.selectedMsaWithAccount=s[0],$(()=>l=!1)),u.$set(v);const k={};d&512&&(k.$$scope={dirty:d,ctx:s}),t.$set(k)},i(s){f||(T(u.$$.fragment,s),T(t.$$.fragment,s),f=!0)},o(s){R(u.$$.fragment,s),R(t.$$.fragment,s),f=!1},d(s){s&&(p(c),p(r),p(n),p(o),p(h),p(A)),Q(u),Q(t,s)}}}function Ue(a,c,e){let r,n,u,l,o;F(a,Ae,f=>e(6,n=f)),F(a,he,f=>e(7,u=f)),F(a,de,f=>e(8,l=f)),F(a,Le,f=>e(2,o=f));let t,h;async function A(){if(r){re(Ae,n={msaId:t.msaId,address:t.account.address},n);const{hasDelegation:f,missingSchemaPermissions:g,expectedSchemaPermissions:_}=await Oe(t.msaId,u.request.providerId,u.request.requiredSchemas.map(s=>s.id||0));he.updateDelegation(!f,g,_),f&&!(g!=null&&g.length)?ue(`${ae}/signin/confirm`):ue(`${ae}/signup/update-delegations`)}else console.error("Button not enabled")}Ce(()=>{n&&e(1,h=n)});function M(f){t=f,e(0,t)}return a.$$.update=()=>{a.$$.dirty&1&&(r=!!t),a.$$.dirty&1&&re(de,l=t,l)},[t,h,o,A,M]}class Qe extends ve{constructor(c){super(),be(this,c,Ue,Re,Me,{})}}export{Qe as component};
