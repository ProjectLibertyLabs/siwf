import{s as Ae,e as w,c as E,b as q,f as p,m as S,i as v,o as we,N as K,X as Ee,a as V,t as O,g as H,d as T,l as Y,M as re,h as I,D as ke,j as J,O as Z,k as U,q as We,P as ie}from"../chunks/scheduler.CSDhDYXB.js";import{S as ve,i as Me,t as P,g as je,f as Ce,b as R,e as $,c as x,a as ee,m as te,d as se}from"../chunks/index.BJ6aBsbe.js";import{a as De}from"../chunks/MsaAccountsDerivedStore.C8Wt2UcZ.js";import{b as ae,g as ue}from"../chunks/entry.hhyJkxgV.js";import{C as de}from"../chunks/CurrentSelectedMsaAccountStore.JHBDlPHn.js";import{e as fe}from"../chunks/each.D6YF6ztN.js";import{n as _e,r as me,s as Le,Q as Oe}from"../chunks/CachedExtensionsStore.EnB0nGkS.js";import{W as Te}from"../chunks/WalletAddressSelector.4TlhPM8G.js";import{F as qe}from"../chunks/FooterButton.BuacVUim.js";import{R as he}from"../chunks/RequestResponseStore.Cjo029FE.js";function pe(a,c,e){const i=a.slice();return i[11]=c[e],i}function ge(a){var ce;let c,e,i,n=!1,u,l,o=_e(a[11].handle)+"",t,h,b,M=me(a[11].handle)+"",f,g,_,s=a[11].msaId+"",d,A,W,L,k,y,Q,B,C,ne='<hr class="flex-grow"/> ',D,z,X,le;function Se(r){a[8](r)}function Ie(r){a[9](r)}let G={active:a[11].msaId===a[2],accounts:Object.values(a[11].accounts),initialSelectedAddress:((ce=a[1])==null?void 0:ce.address)||Object.keys(a[11].accounts)[0]};return a[4]!==void 0&&(G.selectedAddress=a[4]),a[3]!==void 0&&(G.selectedAccount=a[3]),k=new Te({props:G}),K.push(()=>$(k,"selectedAddress",Se)),K.push(()=>$(k,"selectedAccount",Ie)),z=Ee(a[7][0]),{c(){c=w("label"),e=w("input"),u=V(),l=w("span"),t=O(o),h=w("span"),b=O("."),f=O(M),g=w("span"),_=O("(MSA "),d=O(s),A=O(")"),W=V(),L=w("div"),x(k.$$.fragment),B=V(),C=w("div"),C.innerHTML=ne,this.h()},l(r){c=E(r,"LABEL",{class:!0});var m=q(c);e=E(m,"INPUT",{type:!0,name:!0}),u=H(m),l=E(m,"SPAN",{class:!0});var j=q(l);t=T(j,o),j.forEach(p),h=E(m,"SPAN",{class:!0});var N=q(h);b=T(N,"."),f=T(N,M),N.forEach(p),g=E(m,"SPAN",{class:!0});var F=q(g);_=T(F,"(MSA "),d=T(F,s),A=T(F,")"),F.forEach(p),m.forEach(p),W=H(r),L=E(r,"DIV",{class:!0});var oe=q(L);ee(k.$$.fragment,oe),oe.forEach(p),B=H(r),C=E(r,"DIV",{class:!0,"data-svelte-h":!0}),Y(C)!=="svelte-hkjkqh"&&(C.innerHTML=ne),this.h()},h(){S(e,"type","radio"),S(e,"name","msa"),e.__value=i=a[11].msaId,re(e,e.__value),S(l,"class","text-white"),S(h,"class","text-neutral-400"),S(g,"class","pl-5 text-white"),S(c,"class","text-base font-semibold"),S(L,"class","pl-5"),S(C,"class","flex items-center pb-5 pt-3"),z.p(e)},m(r,m){v(r,c,m),I(c,e),e.checked=e.__value===a[2],I(c,u),I(c,l),I(l,t),I(c,h),I(h,b),I(h,f),I(c,g),I(g,_),I(g,d),I(g,A),v(r,W,m),v(r,L,m),te(k,L,null),v(r,B,m),v(r,C,m),D=!0,X||(le=ke(e,"change",a[6]),X=!0)},p(r,m){var N;(!D||m&1&&i!==(i=r[11].msaId))&&(e.__value=i,re(e,e.__value),n=!0),(n||m&5)&&(e.checked=e.__value===r[2]),(!D||m&1)&&o!==(o=_e(r[11].handle)+"")&&J(t,o),(!D||m&1)&&M!==(M=me(r[11].handle)+"")&&J(f,M),(!D||m&1)&&s!==(s=r[11].msaId+"")&&J(d,s);const j={};m&5&&(j.active=r[11].msaId===r[2]),m&1&&(j.accounts=Object.values(r[11].accounts)),m&3&&(j.initialSelectedAddress=((N=r[1])==null?void 0:N.address)||Object.keys(r[11].accounts)[0]),!y&&m&16&&(y=!0,j.selectedAddress=r[4],Z(()=>y=!1)),!Q&&m&8&&(Q=!0,j.selectedAccount=r[3],Z(()=>Q=!1)),k.$set(j)},i(r){D||(P(k.$$.fragment,r),D=!0)},o(r){R(k.$$.fragment,r),D=!1},d(r){r&&(p(c),p(W),p(L),p(B),p(C)),se(k),z.r(),X=!1,le()}}}function Ne(a){let c,e,i=fe(a[0]),n=[];for(let l=0;l<i.length;l+=1)n[l]=ge(pe(a,i,l));const u=l=>R(n[l],1,1,()=>{n[l]=null});return{c(){c=w("div");for(let l=0;l<n.length;l+=1)n[l].c();this.h()},l(l){c=E(l,"DIV",{class:!0});var o=q(c);for(let t=0;t<n.length;t+=1)n[t].l(o);o.forEach(p),this.h()},h(){S(c,"class","flex h-[380px] w-full flex-col overflow-auto bg-transparent")},m(l,o){v(l,c,o);for(let t=0;t<n.length;t+=1)n[t]&&n[t].m(c,null);e=!0},p(l,[o]){if(o&31){i=fe(l[0]);let t;for(t=0;t<i.length;t+=1){const h=pe(l,i,t);n[t]?(n[t].p(h,o),P(n[t],1)):(n[t]=ge(h),n[t].c(),P(n[t],1),n[t].m(c,null))}for(je(),t=i.length;t<n.length;t+=1)u(t);Ce()}},i(l){if(!e){for(let o=0;o<i.length;o+=1)P(n[o]);e=!0}},o(l){n=n.filter(Boolean);for(let o=0;o<n.length;o+=1)R(n[o]);e=!1},d(l){l&&p(c),we(n,l)}}}function Ve(a,c,e){let{msaEntries:i=[]}=c,{selectedMsaWithAccount:n}=c,{initialSelection:u}=c,l,o,t;function h(_,s){const d=i.find(A=>A.msaId===_);if(d){const{accounts:A,...W}=d;e(5,n={...W,account:s})}}const b=[[]];function M(){l=this.__value,e(2,l),e(5,n),e(0,i),e(1,u)}function f(_){t=_,e(4,t)}function g(_){o=_,e(3,o)}return a.$$set=_=>{"msaEntries"in _&&e(0,i=_.msaEntries),"selectedMsaWithAccount"in _&&e(5,n=_.selectedMsaWithAccount),"initialSelection"in _&&e(1,u=_.initialSelection)},a.$$.update=()=>{var _;if(a.$$.dirty&39&&!n&&i.length>0){let s=i[0],d=Object.values(s.accounts)[0];u&&(s=i.find(A=>A.msaId===(u==null?void 0:u.msaId))||s,d=((_=s.accounts)==null?void 0:_[u.address])||Object.values(s.accounts)[0]),e(2,l=s.msaId),h(l,d)}a.$$.dirty&12&&l&&o&&h(l,o)},[i,u,l,o,t,n,M,b,f,g]}class He extends ve{constructor(c){super(),Me(this,c,Ve,Ne,Ae,{msaEntries:0,selectedMsaWithAccount:5,initialSelection:1})}}const be=Le("LastUsedMsaAndAddress");function Pe(a){let c;return{c(){c=O("Next > Sign In")},l(e){c=T(e,"Next > Sign In")},m(e,i){v(e,c,i)},d(e){e&&p(c)}}}function Re(a){let c,e='<span class="text-[16px] font-bold">Choose a handle to sign in with</span>',i,n,u,l,o,t,h,b,M=`<a href="${`${ae}/signup/handle`}" class="text-center text-sm font-semibold">Create an account</a>`,f;function g(s){a[4](s)}let _={msaEntries:Object.values(a[2]),initialSelection:a[1]};return a[0]!==void 0&&(_.selectedMsaWithAccount=a[0]),u=new He({props:_}),K.push(()=>$(u,"selectedMsaWithAccount",g)),t=new qe({props:{$$slots:{default:[Pe]},$$scope:{ctx:a}}}),t.$on("click",a[3]),{c(){c=w("div"),c.innerHTML=e,i=V(),n=w("div"),x(u.$$.fragment),o=V(),x(t.$$.fragment),h=V(),b=w("div"),b.innerHTML=M,this.h()},l(s){c=E(s,"DIV",{class:!0,"data-svelte-h":!0}),Y(c)!=="svelte-6zb4of"&&(c.innerHTML=e),i=H(s),n=E(s,"DIV",{class:!0});var d=q(n);ee(u.$$.fragment,d),d.forEach(p),o=H(s),ee(t.$$.fragment,s),h=H(s),b=E(s,"DIV",{class:!0,"data-svelte-h":!0}),Y(b)!=="svelte-1560jx3"&&(b.innerHTML=M),this.h()},h(){S(c,"class","flex h-full items-center justify-center pb-9"),S(n,"class","pb-[64px]"),S(b,"class","flex items-center justify-center pb-4 pt-8")},m(s,d){v(s,c,d),v(s,i,d),v(s,n,d),te(u,n,null),v(s,o,d),te(t,s,d),v(s,h,d),v(s,b,d),f=!0},p(s,[d]){const A={};d&4&&(A.msaEntries=Object.values(s[2])),d&2&&(A.initialSelection=s[1]),!l&&d&1&&(l=!0,A.selectedMsaWithAccount=s[0],Z(()=>l=!1)),u.$set(A);const W={};d&512&&(W.$$scope={dirty:d,ctx:s}),t.$set(W)},i(s){f||(P(u.$$.fragment,s),P(t.$$.fragment,s),f=!0)},o(s){R(u.$$.fragment,s),R(t.$$.fragment,s),f=!1},d(s){s&&(p(c),p(i),p(n),p(o),p(h),p(b)),se(u),se(t,s)}}}function Be(a,c,e){let i,n,u,l,o;U(a,be,f=>e(6,n=f)),U(a,he,f=>e(7,u=f)),U(a,de,f=>e(8,l=f)),U(a,De,f=>e(2,o=f));let t,h;async function b(){if(i){ie(be,n={msaId:t.msaId,address:t.account.address},n);const{hasDelegation:f,missingSchemaPermissions:g,expectedSchemaPermissions:_}=await Oe(t.msaId,u.request.providerId,u.request.requiredSchemas.map(s=>s.id||0));he.updateDelegation(!f,g,_),f&&!(g!=null&&g.length)?ue(`${ae}/signin/confirm`):ue(`${ae}/signup/update-delegations`)}else console.error("Button not enabled")}We(()=>{n&&e(1,h=n)});function M(f){t=f,e(0,t)}return a.$$.update=()=>{a.$$.dirty&1&&(i=!!t),a.$$.dirty&1&&ie(de,l=t,l)},[t,h,o,b,M]}class Ze extends ve{constructor(c){super(),Me(this,c,Be,Re,Ae,{})}}export{Ze as component};
