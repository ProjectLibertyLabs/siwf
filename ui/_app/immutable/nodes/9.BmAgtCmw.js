import{s as W,a as H,g as T,i as N,f as p,k as C,e as v,t as S,c as $,b as y,d as P,m as _,h as u,j as k,o as J,n as O}from"../chunks/scheduler.CSDhDYXB.js";import{S as Q,i as X,c as U,a as z,m as B,t as L,b as V,d as F}from"../chunks/index.BJ6aBsbe.js";import{e as K}from"../chunks/each.D6YF6ztN.js";import{C as Y}from"../chunks/CurrentSelectedExtensionIdStore.CtGo1yUd.js";import{g as Z,a as ee,s as te}from"../chunks/index.CMEuxWn0.js";import{K as se}from"../chunks/CachedExtensionsStore.EnB0nGkS.js";import{F as ae}from"../chunks/FooterButton.BuacVUim.js";import{P as oe}from"../chunks/PayloadConfirmation.CdQvoweP.js";import{R as M}from"../chunks/RequestResponseStore.Cjo029FE.js";import{C as re}from"../chunks/CurrentSelectedMsaAccountStore.JHBDlPHn.js";import"../chunks/MsaAccountsDerivedStore.C8Wt2UcZ.js";import"../chunks/ConnectedExtensionsDerivedStore.DGUx2Jo7.js";import{D as ne}from"../chunks/DSNPSchemas.0SjUiJWi.js";function j(n,e,a){const s=n.slice();return s[6]=e[a],s}function ie(n){let e,a=n[1].request.isNewProvider?"Authorize a new Provider":"Updated permissions requested",s;return{c(){e=v("span"),s=S(a),this.h()},l(o){e=$(o,"SPAN",{slot:!0,class:!0});var t=y(e);s=P(t,a),t.forEach(p),this.h()},h(){_(e,"slot","heading"),_(e,"class","text-[16px] font-bold")},m(o,t){N(o,e,t),u(e,s)},p(o,t){t&2&&a!==(a=o[1].request.isNewProvider?"Authorize a new Provider":"Updated permissions requested")&&k(s,a)},d(o){o&&p(e)}}}function le(n){let e,a,s=n[2].handle+"",o;return{c(){e=v("span"),a=v("span"),o=S(s),this.h()},l(t){e=$(t,"SPAN",{slot:!0});var r=y(e);a=$(r,"SPAN",{class:!0});var m=y(a);o=P(m,s),m.forEach(p),r.forEach(p),this.h()},h(){_(a,"class","text-[16px] font-semibold"),_(e,"slot","subheading")},m(t,r){N(t,e,r),u(e,a),u(a,o)},p(t,r){r&4&&s!==(s=t[2].handle+"")&&k(o,s)},d(t){t&&p(e)}}}function G(n){let e,a=n[6].description+"",s;return{c(){e=v("li"),s=S(a),this.h()},l(o){e=$(o,"LI",{class:!0});var t=y(e);s=P(t,a),t.forEach(p),this.h()},h(){_(e,"class","text-base font-normal")},m(o,t){N(o,e,t),u(e,s)},p:O,d(o){o&&p(e)}}}function ce(n){var R;let e,a,s,o,t=((R=n[1].request)==null?void 0:R.providerName)+"",r,m,f,i=new URL(document.referrer).hostname+"",g,w,A,x,q=K(n[3]),d=[];for(let l=0;l<q.length;l+=1)d[l]=G(j(n,q,l));return{c(){e=v("div"),a=v("div"),s=v("span"),o=S('By clicking "Next" and signing the resulting payload, you authorize the provider "'),r=S(t),m=S(`", operating from the domain
        `),f=v("a"),g=S(i),w=S(", to do the following"),A=H(),x=v("ul");for(let l=0;l<d.length;l+=1)d[l].c();this.h()},l(l){e=$(l,"DIV",{slot:!0});var b=y(e);a=$(b,"DIV",{});var h=y(a);s=$(h,"SPAN",{class:!0});var c=y(s);o=P(c,'By clicking "Next" and signing the resulting payload, you authorize the provider "'),r=P(c,t),m=P(c,`", operating from the domain
        `),f=$(c,"A",{class:!0,href:!0});var E=y(f);g=P(E,i),E.forEach(p),w=P(c,", to do the following"),c.forEach(p),A=T(h),x=$(h,"UL",{class:!0});var I=y(x);for(let D=0;D<d.length;D+=1)d[D].l(I);I.forEach(p),h.forEach(p),b.forEach(p),this.h()},h(){_(f,"class","underline"),_(f,"href",document.referrer),_(s,"class","text-base font-bold"),_(x,"class","list-disc pl-6 pt-3"),_(e,"slot","payloadDescription")},m(l,b){N(l,e,b),u(e,a),u(a,s),u(s,o),u(s,r),u(s,m),u(s,f),u(f,g),u(s,w),u(a,A),u(a,x);for(let h=0;h<d.length;h+=1)d[h]&&d[h].m(x,null)},p(l,b){var h;if(b&2&&t!==(t=((h=l[1].request)==null?void 0:h.providerName)+"")&&k(r,t),b&8){q=K(l[3]);let c;for(c=0;c<q.length;c+=1){const E=j(l,q,c);d[c]?d[c].p(E,b):(d[c]=G(E),d[c].c(),d[c].m(x,null))}for(;c<d.length;c+=1)d[c].d(1);d.length=q.length}},d(l){l&&p(e),J(d,l)}}}function de(n){let e;return{c(){e=S("Next > Sign")},l(a){e=P(a,"Next > Sign")},m(a,s){N(a,e,s)},d(a){a&&p(e)}}}function pe(n){let e,a,s,o;return e=new oe({props:{payload:n[0],$$slots:{payloadDescription:[ce],subheading:[le],heading:[ie]},$$scope:{ctx:n}}}),s=new ae({props:{$$slots:{default:[de]},$$scope:{ctx:n}}}),s.$on("click",n[4]),{c(){U(e.$$.fragment),a=H(),U(s.$$.fragment)},l(t){z(e.$$.fragment,t),a=T(t),z(s.$$.fragment,t)},m(t,r){B(e,t,r),N(t,a,r),B(s,t,r),o=!0},p(t,[r]){const m={};r&1&&(m.payload=t[0]),r&518&&(m.$$scope={dirty:r,ctx:t}),e.$set(m);const f={};r&512&&(f.$$scope={dirty:r,ctx:t}),s.$set(f)},i(t){o||(L(e.$$.fragment,t),L(s.$$.fragment,t),o=!0)},o(t){V(e.$$.fragment,t),V(s.$$.fragment,t),o=!1},d(t){t&&p(a),F(e,t),F(s,t)}}}function ue(n,e,a){let s,o,t;C(n,M,i=>a(1,s=i)),C(n,re,i=>a(2,o=i)),C(n,Y,i=>a(5,t=i));let r,m=s.request.requiredSchemas.filter(({id:i})=>s.request.missingSchemas.some(g=>g===i)).map(i=>{const g=ne.find(w=>w.name===i.name);return{...i,description:(g==null?void 0:g.description)||`Update data associated with the ${i.name} schema`}});Z(s.request.providerId,s.request.allSchemasToGrant).then(({bytes:i})=>{a(0,r=i)});async function f(){try{const i=await ee(t,o.account.address,r),g=(await se(o.account.address,{Sr25519:i.toString()},r)).toHex();M.upsertExtrinsic({pallet:"msa",extrinsicName:"grantDelegation",encodedExtrinsic:g}),await te(s.response)}catch(i){console.error("Payload not signed",i)}}return[r,s,o,m,f]}class Ne extends Q{constructor(e){super(),X(this,e,ue,pe,W,{})}}export{Ne as component};
