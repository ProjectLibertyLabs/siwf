import{s as Ae,d as p,o as we,i as v,l as S,c as w,e as q,h as E,N as Q,X as Ee,M as ie,a as K,O as Y,b as I,G as je,g as H,f as T,m as Z,j as P,t as O,k as F,q as ke,P as re}from"../chunks/CKFRV2U2.js";import{S as ve,i as Me,t as R,a as V,g as We,f as Ce,e as $,d as x,m as ee,c as te,b as se}from"../chunks/C4UniOSA.js";import{a as Le}from"../chunks/D5uLV3di.js";import{b as ae,g as ue}from"../chunks/DklrAeTm.js";import{C as de}from"../chunks/DW3dk5T8.js";import{e as fe}from"../chunks/D6YF6ztN.js";import{y as _e,m as me,j as De,p as Te}from"../chunks/Bz1-qmYa.js";import{W as Oe}from"../chunks/D2EjFFxv.js";import{F as qe}from"../chunks/CcuJL688.js";import{R as he}from"../chunks/BemOOD-p.js";function pe(a,c,e){const r=a.slice();return r[11]=c[e],r}function ge(a){var ce;let c,e,r,n=!1,u,l,o=_e(a[11].handle)+"",t,h,b,M=me(a[11].handle)+"",f,g,_,s=a[11].msaId+"",d,A,k,D,j,U,z,y,C,ne='<hr class="flex-grow"/> ',L,G,X,le;function Se(i){a[8](i)}function Ie(i){a[9](i)}let J={active:a[11].msaId===a[2],accounts:Object.values(a[11].accounts),initialSelectedAddress:((ce=a[1])==null?void 0:ce.address)||Object.keys(a[11].accounts)[0]};return a[4]!==void 0&&(J.selectedAddress=a[4]),a[3]!==void 0&&(J.selectedAccount=a[3]),j=new Oe({props:J}),Q.push(()=>$(j,"selectedAddress",Se)),Q.push(()=>$(j,"selectedAccount",Ie)),G=Ee(a[7][0]),{c(){c=E("label"),e=E("input"),u=P(),l=E("span"),t=O(o),h=E("span"),b=O("."),f=O(M),g=E("span"),_=O("(MSA "),d=O(s),A=O(")"),k=P(),D=E("div"),se(j.$$.fragment),y=P(),C=E("div"),C.innerHTML=ne,this.h()},l(i){c=w(i,"LABEL",{class:!0});var m=q(c);e=w(m,"INPUT",{type:!0,name:!0}),u=H(m),l=w(m,"SPAN",{class:!0});var W=q(l);t=T(W,o),W.forEach(p),h=w(m,"SPAN",{class:!0});var N=q(h);b=T(N,"."),f=T(N,M),N.forEach(p),g=w(m,"SPAN",{class:!0});var B=q(g);_=T(B,"(MSA "),d=T(B,s),A=T(B,")"),B.forEach(p),m.forEach(p),k=H(i),D=w(i,"DIV",{class:!0});var oe=q(D);te(j.$$.fragment,oe),oe.forEach(p),y=H(i),C=w(i,"DIV",{class:!0,"data-svelte-h":!0}),Z(C)!=="svelte-hkjkqh"&&(C.innerHTML=ne),this.h()},h(){S(e,"type","radio"),S(e,"name","msa"),e.__value=r=a[11].msaId,ie(e,e.__value),S(l,"class","text-white"),S(h,"class","text-neutral-400"),S(g,"class","pl-5 text-white"),S(c,"class","text-base font-semibold"),S(D,"class","pl-5"),S(C,"class","flex items-center pb-5 pt-3"),G.p(e)},m(i,m){v(i,c,m),I(c,e),e.checked=e.__value===a[2],I(c,u),I(c,l),I(l,t),I(c,h),I(h,b),I(h,f),I(c,g),I(g,_),I(g,d),I(g,A),v(i,k,m),v(i,D,m),ee(j,D,null),v(i,y,m),v(i,C,m),L=!0,X||(le=je(e,"change",a[6]),X=!0)},p(i,m){var N;(!L||m&1&&r!==(r=i[11].msaId))&&(e.__value=r,ie(e,e.__value),n=!0),(n||m&5)&&(e.checked=e.__value===i[2]),(!L||m&1)&&o!==(o=_e(i[11].handle)+"")&&K(t,o),(!L||m&1)&&M!==(M=me(i[11].handle)+"")&&K(f,M),(!L||m&1)&&s!==(s=i[11].msaId+"")&&K(d,s);const W={};m&5&&(W.active=i[11].msaId===i[2]),m&1&&(W.accounts=Object.values(i[11].accounts)),m&3&&(W.initialSelectedAddress=((N=i[1])==null?void 0:N.address)||Object.keys(i[11].accounts)[0]),!U&&m&16&&(U=!0,W.selectedAddress=i[4],Y(()=>U=!1)),!z&&m&8&&(z=!0,W.selectedAccount=i[3],Y(()=>z=!1)),j.$set(W)},i(i){L||(V(j.$$.fragment,i),L=!0)},o(i){R(j.$$.fragment,i),L=!1},d(i){i&&(p(c),p(k),p(D),p(y),p(C)),x(j),G.r(),X=!1,le()}}}function Ne(a){let c,e,r=fe(a[0]),n=[];for(let l=0;l<r.length;l+=1)n[l]=ge(pe(a,r,l));const u=l=>R(n[l],1,1,()=>{n[l]=null});return{c(){c=E("div");for(let l=0;l<n.length;l+=1)n[l].c();this.h()},l(l){c=w(l,"DIV",{class:!0});var o=q(c);for(let t=0;t<n.length;t+=1)n[t].l(o);o.forEach(p),this.h()},h(){S(c,"class","flex h-[380px] w-full flex-col overflow-auto bg-transparent")},m(l,o){v(l,c,o);for(let t=0;t<n.length;t+=1)n[t]&&n[t].m(c,null);e=!0},p(l,[o]){if(o&31){r=fe(l[0]);let t;for(t=0;t<r.length;t+=1){const h=pe(l,r,t);n[t]?(n[t].p(h,o),V(n[t],1)):(n[t]=ge(h),n[t].c(),V(n[t],1),n[t].m(c,null))}for(We(),t=r.length;t<n.length;t+=1)u(t);Ce()}},i(l){if(!e){for(let o=0;o<r.length;o+=1)V(n[o]);e=!0}},o(l){n=n.filter(Boolean);for(let o=0;o<n.length;o+=1)R(n[o]);e=!1},d(l){l&&p(c),we(n,l)}}}function He(a,c,e){let{msaEntries:r=[]}=c,{selectedMsaWithAccount:n}=c,{initialSelection:u}=c,l,o,t;function h(_,s){const d=r.find(A=>A.msaId===_);if(d){const{accounts:A,...k}=d;e(5,n={...k,account:s})}}const b=[[]];function M(){l=this.__value,e(2,l),e(5,n),e(0,r),e(1,u)}function f(_){t=_,e(4,t)}function g(_){o=_,e(3,o)}return a.$$set=_=>{"msaEntries"in _&&e(0,r=_.msaEntries),"selectedMsaWithAccount"in _&&e(5,n=_.selectedMsaWithAccount),"initialSelection"in _&&e(1,u=_.initialSelection)},a.$$.update=()=>{var _;if(a.$$.dirty&39&&!n&&r.length>0){let s=r[0],d=Object.values(s.accounts)[0];u&&(s=r.find(A=>A.msaId===(u==null?void 0:u.msaId))||s,d=((_=s.accounts)==null?void 0:_[u.address])||Object.values(s.accounts)[0]),e(2,l=s.msaId),h(l,d)}a.$$.dirty&12&&l&&o&&h(l,o)},[r,u,l,o,t,n,M,b,f,g]}class Pe extends ve{constructor(c){super(),Me(this,c,He,Ne,Ae,{msaEntries:0,selectedMsaWithAccount:5,initialSelection:1})}}const be=De("LastUsedMsaAndAddress");function Ve(a){let c;return{c(){c=O("Next > Sign In")},l(e){c=T(e,"Next > Sign In")},m(e,r){v(e,c,r)},d(e){e&&p(c)}}}function Re(a){let c,e='<span class="text-[16px] font-bold">Choose a handle to sign in with</span>',r,n,u,l,o,t,h,b,M=`<a href="${`${ae}/signup/handle`}" class="text-center text-sm font-semibold">Create an account</a>`,f;function g(s){a[4](s)}let _={msaEntries:Object.values(a[2]),initialSelection:a[1]};return a[0]!==void 0&&(_.selectedMsaWithAccount=a[0]),u=new Pe({props:_}),Q.push(()=>$(u,"selectedMsaWithAccount",g)),t=new qe({props:{$$slots:{default:[Ve]},$$scope:{ctx:a}}}),t.$on("click",a[3]),{c(){c=E("div"),c.innerHTML=e,r=P(),n=E("div"),se(u.$$.fragment),o=P(),se(t.$$.fragment),h=P(),b=E("div"),b.innerHTML=M,this.h()},l(s){c=w(s,"DIV",{class:!0,"data-svelte-h":!0}),Z(c)!=="svelte-6zb4of"&&(c.innerHTML=e),r=H(s),n=w(s,"DIV",{class:!0});var d=q(n);te(u.$$.fragment,d),d.forEach(p),o=H(s),te(t.$$.fragment,s),h=H(s),b=w(s,"DIV",{class:!0,"data-svelte-h":!0}),Z(b)!=="svelte-1560jx3"&&(b.innerHTML=M),this.h()},h(){S(c,"class","flex h-full items-center justify-center pb-9"),S(n,"class","pb-[64px]"),S(b,"class","flex items-center justify-center pb-4 pt-8")},m(s,d){v(s,c,d),v(s,r,d),v(s,n,d),ee(u,n,null),v(s,o,d),ee(t,s,d),v(s,h,d),v(s,b,d),f=!0},p(s,[d]){const A={};d&4&&(A.msaEntries=Object.values(s[2])),d&2&&(A.initialSelection=s[1]),!l&&d&1&&(l=!0,A.selectedMsaWithAccount=s[0],Y(()=>l=!1)),u.$set(A);const k={};d&512&&(k.$$scope={dirty:d,ctx:s}),t.$set(k)},i(s){f||(V(u.$$.fragment,s),V(t.$$.fragment,s),f=!0)},o(s){R(u.$$.fragment,s),R(t.$$.fragment,s),f=!1},d(s){s&&(p(c),p(r),p(n),p(o),p(h),p(b)),x(u),x(t,s)}}}function ye(a,c,e){let r,n,u,l,o;F(a,be,f=>e(6,n=f)),F(a,he,f=>e(7,u=f)),F(a,de,f=>e(8,l=f)),F(a,Le,f=>e(2,o=f));let t,h;async function b(){if(r){re(be,n={msaId:t.msaId,address:t.account.address},n);const{hasDelegation:f,missingSchemaPermissions:g,expectedSchemaPermissions:_}=await Te(t.msaId,u.request.providerId,u.request.requiredSchemas.map(s=>s.id||0));he.updateDelegation(!f,g,_),f&&!(g!=null&&g.length)?ue(`${ae}/signin/confirm`):ue(`${ae}/signup/update-delegations`)}else console.error("Button not enabled")}ke(()=>{n&&e(1,h=n)});function M(f){t=f,e(0,t)}return a.$$.update=()=>{a.$$.dirty&1&&(r=!!t),a.$$.dirty&1&&re(de,l=t,l)},[t,h,o,b,M]}class Ze extends ve{constructor(c){super(),Me(this,c,ye,Re,Ae,{})}}export{Ze as component};
